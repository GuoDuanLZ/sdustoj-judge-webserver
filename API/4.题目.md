题目相关API
===

出于方便管理的目的，将题目分拆成题元及题目两部分。

<br />

## 题元及题目概念

定义：

```
题元 = { 题意描述集, 样例描述集, 测试数据集 }
题意描述集 = { d | type(d) = 题意描述 }
样例描述集 = { s | type(s) = 样例描述 }
测试数据集 = { t | type(t) = 测试数据 }
测试数据 = { 测试输入, 测试输出 }
题目 = { ptr(题元), ptr(题意描述), ptr(样例描述), 限制集, 测试数据选用集 }
限制集 = { l | type(l) = 限制 }
限制 = { ptr(编程环境), 时间限制, 内存限制, 代码长度限制 }
测试数据选用集 = { t | type(t) = ptr(测试数据) }
```

限制：

```
题意描述所属题意描述集 ∈ 题目->题元
样例描述所属样例描述集 ∈ 题目->题元
测试数据所属测试数据集 ∈ 题目->题元
```

建议的格式：

```
题意描述 = { 题目简介, 输入描述, 输出描述 }
样例描述 = { s | type(s) = 样例 }，样例 = { 样例输入, 样例输出 }
```

<br />

## 题元API

### 权限

题目管理员有权使用此套API。

### API

* 题元基本信息

    * 列表

        URL：

        ```
        GET|POST /api-server/meta-problems/
        ```

        属性：

        ```
        {
            *id: 题元id,
            title: 标题,
            introduction: 简介,
            source: 来源,
            author: 原作者,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET|PUT|PATCH|DELETE /api-server/meta-problems/{ meta_problem id }/
        ```

        属性：

        ```
        {
            *id: 题元id,
            title: 标题,
            introduction: 简介,
            source: 来源,
            author: 原作者,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

* 题意描述集

    * 列表

        URL：

        ```
        GET|POST /api-server/meta-problems/{ meta_problem id }/descriptions/
        ```

        属性：

        ```
        {
            *id: 题意描述id,
            title: 标题,
            introduction: 简介,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET|PUT|PATCH|DELETE /api-server/meta-problems/{ meta_problem id }/descriptions/{ description id }/
        ```

        属性：

        ```
        {
            *id: 题意描述id,
            title: 标题,
            introduction: 简介,
            content: 正文,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

* 样例描述集

    * 列表

        URL：

        ```
        GET|POST /api-server/meta-problems/{ meta_problem id }/samples/
        ```

        属性：

        ```
        {
            *id: 样例描述id,
            title: 标题,
            introduction: 简介,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET|PUT|PATCH|DELETE /api-server/meta-problems/{ meta_problem id }/samples/{ sample id }/
        ```

        属性：

        ```
        {
            *id: 样例描述id,
            title: 标题,
            introduction: 简介,
            content: 正文,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```
    
* 测试数据

    * 列表

        URL：

        ```
        GET|POST /api-server/meta-problems/{ meta_problem id }/test-data/
        ```

        属性：

        ```
        {
            *id: 测试数据id,
            title: 标题,
            introduction: 简介,
            status: 状态,
            *in_size: 输入大小,
            *out_size: 输出大小,
            #test_in: 测试输入（只接受小于150k的输入，否则需要使用上传API）,
            #test_out: 测试输出（只接受小于150k的输出，否则需要使用上传API）,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET|PUT|PATCH|DELETE /api-server/meta-problems/{ meta_problem id }/test-data/{ test_data id }/
        ```

        属性：

        ```
        {
            *id: 测试数据id,
            title: 标题,
            introduction: 简介,
            status: 状态,
            *in_size: 输入大小,
            *out_size: 输出大小,
            test_in: 测试输入（查询时只显示前150k的部分）,
            test_out: 测试输出（查询时只显示前150k的部分）,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

        如果更新的数据规模大于150k，则需要使用上传测试输入或测试输出的方式更新。
    
    * 下载测试输入
        
        URL：

        ```
        GET /api-server/meta-problems/{ meta_problem id }/test-data-files/{ test_data id }/in/
        ```

        访问此URL将下载测试输入文件
    
    * 下载测试输出

        URL：

        ```
        GET /api-server/meta-problems/{ meta_problem id }/test-data-files/{ test_data id }/out/
        ```

        访问此URL将下载测试输出文件

    * 上传文件创建测试数据

        对于测试输入或输出规模大于150k的测试数据，需要通过上传文件的方式建立。

        URL:

        ```
        POST /api-server/meta-problems/{ meta_problem id }/test-data-files/
        ```

        属性：

        ```
        {
            title: 标题,
            introduction: 简介,
            status: 状态,
            test_in: 测试输入文件,
            test_out: 测试输出文件,
        }
        ```
    
    * 上传更新测试输入

        对于需要更新且更新后规模大于150k的测试输入，需要通过文件上传的方式更新。

        URL：

        ```
        PUT|PATCH /api-server/meta-problems/{ meta_problem id }/test-data-in/{ test_data id }/
        ```

        属性：
        
        ```
        {
            title: 标题,
            introduction: 简介,
            status: 状态,
            test_in: 测试输入文件,
        }
        ```

    * 上传更新测试输出

        对于需要更新且更新后规模大于150k的测试输出，需要通过文件上传的方式更新。

        URL：

        ```
        PUT|PATCH /api-server/meta-problems/{ meta_problem id }/test-data-out/{ test_data id }/
        ```

        属性：
        
        ```
        {
            title: 标题,
            introduction: 简介,
            status: 状态,
            test_out: 测试输出文件,
        }
        ```
    
<br />

## 题目API

### 权限

题目管理员有权使用全套API。

题库管理员有权使用部分API，且只有读（GET请求列表或详情）的权限，下面API中题库管理员可读的API将特别标明。

### API

* 题目基本信息（在题元中）

    * 详情

        URL：

        ```
        GET|POST /api-server/meta-problems/{ meta_problem id }/problems/
        ```

        属性：

        ```
        {
            *id: 题目id,
            title: 标题,
            introduction: 简介,
            test_type: 评测类型（严格(normal)、非空白符(ignBlank)、非标点符(ignPunct)、特殊评测(SPJ)）,
            *meta_problem: 所属题元id,
            description: 选用的题意描述id,
            sample: 选用的样例描述id,
            source: 来源,
            author: 原作者,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间,
        }
        ```

    * 列表

        URL：

        ```
        GET|PUT|PATCH|DELETE /api-server/meta-problems/{ meta_problem id }/problems/{ problem id }/
        ```

        属性：

        ```
        {
            *id: 题目id,
            title: 标题,
            introduction: 简介,
            test_type: 评测类型（严格、非空白符、非标点符）,
            *meta_problem: 所属题元id,
            description: 选用的题意描述id,
            sample: 选用的样例描述id,
            source: 来源,
            author: 原作者,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间,
        }
        ```

* 题目基本信息（**只读，题库管理员可读**）
    * 列表

        URL：

        ```
        GET /api-server/prooblems/
        ```

        属性：

        ```
        {
            *id: 题目id,
            *title: 标题,
            *introduction: 简介,
            *test_type: 评测类型（严格、非空白符、非标点符）,
            *meta_problem: 所属题元id,
            *description: 选用的题意描述id,
            *sample: 选用的样例描述id,
            *source: 来源,
            *author: 原作者,
            *status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间,
        }
        ```
    
    * 详情

        URL：

        ```
        GET /api-server/problems/{ problem id }/
        ```

        属性：

        ```
        {
            *id: 题目id,
            *title: 标题,
            *introduction: 简介,
            *test_type: 评测类型（严格、非空白符、非标点符）,
            *meta_problem: 所属题元id,
            *description: 选用的题意描述id,
            *sample: 选用的样例描述id,
            *source: 来源,
            *author: 原作者,
            *status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间,
        }
        ```

* 题意描述（**题库管理员可读**）

    直接查看指定题目的题意描述。

    URL:

    ```
    GET /api-server/problems/{ problem id }/description/
    ```

    属性：
    
    ```
    {
        *id: 题意描述id,
        *content: 题意描述正文
    }
    ```

* 样例描述（**题库管理员可读**）

    直接查看指定题目的样例描述。

    URL:

    ```
    GET /api-server/problems/{ problem id }/sample/
    ```

    属性：

    ```
    {
        *id: 样例描述id,
        *content: 样例描述正文
    }
    ```

* 题目限制集（**题库管理员可读**）

    * 列表

        URL：

        ```
        GET|POST /api-server/problems/{ problem id }/limits/
        ```

        属性：
        
        ```
        {
            *id: 题目限制id,
            *problem: 该限制所属题目,
            title: 题目,
            introduction: 简介,
            environment: 该限制所属环境id（给机器看）,
            *language: 该限制环境代表的语言（给人看）,
            time_limit: 时间限制,
            memory_limit: 内存限制,
            length_limit: 代码长度限制,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET|PUT|PATCH|DELETE /api-server/problems/{ problem id }/limits/{ limit id }/
        ```

        属性：
        
        ```
        {
            *id: 题目限制id,
            *problem: 该限制所属题目,
            title: 题目,
            introduction: 简介,
            environment: 该限制所属环境id（给机器看）,
            *language: 该限制环境代表的语言（给人看）,
            time_limit: 时间限制,
            memory_limit: 内存限制,
            length_limit: 代码长度限制,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

* 题目测试数据

    * 列表

        URL：

        ```
        GET /api-server/problems/{ problem id }/test-data/
        ```

        属性：

        ```
        {
            *id: 测试数据id,
            *meta_problem: 所属题元,
            *in_size: 输入大小,
            *out_size: 输出大小,
            title: 题目,
            introduction: 简介,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET /api-server/problems/{ problem id }/test-data/{ test_data id }/
        ```

        属性：

        ```
        {
            *id: 测试数据id,
            *meta_problem: 所属题元,
            *in_size: 输入大小,
            *out_size: 输出大小,
            title: 题目,
            introduction: 简介,
            status: 状态,
            *creator: 创建者,
            *updater: 更新者,
            *create_time: 创建时间,
            *update_time: 更新时间
        }
        ```

* 题目与测试数据的连接

    * 列表

        URL：

        ```
        GET|POST /api-server/problems/{ problem id }/test-data-rel/
        ```

        属性：

        ```
        {
            *id: 连接id,
            *problem: 所属题目,
            test_data: 连接的测试数据,
            *creator: 创建者,
            *updater: 最后更新者,
            *create_time: 创建时间,
            *update_time: 最后更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET|DELETE /api-server/problems/{ problem id }/test-data-rel/{ test_data_relation id }/
        ```

        属性：

        ```
        {
            *id: 连接id,
            *problem: 所属题目,
            test_data: 连接的测试数据,
            *creator: 创建者,
            *updater: 最后更新者,
            *create_time: 创建时间,
            *update_time: 最后更新时间
        }
        ```

* Special Judge

    * 列表

        **一道题目最多只有一个特殊评测**

        URL:

        ```
        GET|POST /api-server/problems/{ problem id }/special-judge/
        ```

        属性：

        ```
        {
            *id: 特殊评测id,
            title: 标题,
            introduction: 简介,
            *problem: 题目,
            environment: 特殊评测代码的语言环境id,
            #code: 代码，
            *creator: 创建者,
            *updater: 最后更新者,
            *create_time: 创建时间,
            *update_time: 最后更新时间
        }
        ```

    * 详情

        URL:

        ```
        GET|PUT|PATCH|DELETE /api-server/problems/{ problem id }/special-judge/{ special_judge id }/
        ```

        属性：

        ```
        {
            *id: 特殊评测id,
            title: 标题,
            introduction: 简介,
            *problem: 题目,
            environment: 特殊评测代码的语言环境id,
            #code: 代码，
            *creator: 创建者,
            *updater: 最后更新者,
            *create_time: 创建时间,
            *update_time: 最后更新时间
        }
        ```

* 非法单词（**题库管理员可读**）

    * 列表

        URL：

        ```
        GET|POST /api-server/problems/{ problem id }/invalid-words/
        ```

        属性：

        ```'
        {
            *id: 禁用单词id,
            *problem: 禁用单词所属题目,
            word: 单词,
            *creator: 创建者,
            *updater: 最后更新者,
            *create_time: 创建时间,
            *update_time: 最后更新时间
        }
        ```

    * 详情

        URL：

        ```
        GET|POST /api-server/problems/{ problem id }/invalid-words/{ invalid_words id }/
        ```

        属性：

        ```
        {
            *id: 禁用单词id,
            *problem: 禁用单词所属题目,
            word: 单词,
            *creator: 创建者,
            *updater: 最后更新者,
            *create_time: 创建时间,
            *update_time: 最后更新时间
        }
        ```

* 创建全新题目

    普通题目的创建需在题元下进行。使用创建全新题目的API可以在不使用已有题元的情况下一步创建题元及题目。
    **目前测试数据无法在一步创建中自动创建。**

    URL：

    ```
    POST /api-server/new-problems/
    ```

    属性：

    ```
    {
        *meta_problem: 创建后返回生成的题元id,
        *id: 创建后返回生成的题目id,
        test_type: 测试类型,
        description: 题意描述全文,
        sample: 样例描述全文,
        limits: 编程显示，数组，内部元素格式参见题目限制属性
    }
    ```
