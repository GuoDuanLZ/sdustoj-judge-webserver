评测端 API整体说明
===

评测端API基于Django Rest Framework开发，并使用DRF Nested Routers对路由进行了扩展。

对外提供一套接近REST风格的API供评测端前端使用和进一步开发扩展。

<br />

## URL设计与请求类型

与RESTful API类似，评测端API使用URL定位资源，通过请求类型控制对资源的操作方式。

评测端API根目录为```/api-server/```，之后通过资源名称对请求资源进行定位，如：
```
/api-server/problems/                 # 定位到所有题目
/api-server/problems/{ problem id }/  # 定位到某道题目
```
为方便表示，将上述例子的第一个定位的资源称为列表（List），将第二个定位的资源称为详情（Detail）。

某些资源下可能存在下一级子资源，则定位设计为在上一级资源的详情下继续通过资源名称定位资源，如：
```
/api-server/problems/{ problem id }/limits/               # 定位到某题目下的所有限制条件
/api-server/problems/{ problem id }/limits/{ limit id }/  # 定位到某题目下的某个限制条件
```

评测端API的请求类型分为五种，分别为：

* GET：表示对资源的查询操作，该操作通常支持通过参数实现对查询结果的过滤，资源的列表和详情均可查询。
* POST：表示对资源的创建操作，只可在资源的列表上进行创建操作。
* PUT：表示对资源的更新操作，使用PUT请求更新资源**要求提供被更新资源的全部属性，即便某些属性不需要修改**，因此不推荐使用。更新时需要定位到资源详情（不支持批量更新）。
* PATCH： 表示对资源的更新操作，使用PATCH请求更新资源**只需提供需修改属性希望修改成的值即可**，推荐使用PATCH请求更新资源。更新时需要定位到资源的详情（不支持批量更新）。
* DELETE：表示对资源的删除操作。删除时需要定位到资源的详情（不支持批量删除）。

这里以题目为例展示API使用方法：
```
GET    /api-server/problems/                 # 查询所有题目
GET    /api-server/problems/{ problem id }/  # 查询某道题目的详情
POST   /api-server/problems/                 # 创建一道题目
PUT    /api-server/problems/{ problem id }/  # 更新一道题目（提供全部属性）
PATCH  /api-server/problems/{ problem id }/  # 更新一道题目（只提供需修改属性）
DELETE /api-server/problems/{ problem id }/  # 删除一道题目
```

<br />

## 请求的参数
    
* 对于GET请求，如果支持过滤、搜索、排序，可直接在URL中给出参数，如：
    ```
    /api-server/problems/?ordering=-id  # 按照id倒序排列返回题目列表
    ```
    具体使用GET方法过滤、搜索、排序的使用方法请参见[Django REST Framework官方文档](http://www.django-rest-framework.org/)

* 对于POST、PUT、PATCH、DELET请求，提交的参数应以JSON数据的格式提交。

<br />

## 返回的结果

整体上，请求返回的结果分为状态码和数据两部分。
    
状态码表示结果的类型，通常返回的状态码有：

* 表示请求成功：
    * 200 OK：查询或更新成功，通常用于GET、PUT、PATCH请求。
    * 201 CREATED：创建成功，通常用于POST请求。
    * 202 Accepted：异步任务已经接收，通常用于一些不当场返回结果的操作。
    * 204 NO CONTENT：删除成功。
    
* 表示请求错误：
    * 400 INVALID REQUEST：用户发出的请求有误，通常为参数格式错误。
    * 401 Unauthorized：用户没有权限（未登录）。
    * 403 Forbidden：禁止访问此处资源。
    * 404 NOT FOUND：为找到对应资源。
    * 500 INTERNAL SERVER ERROR：服务器内部错误。
    
数据均为JSON格式数据，如果请求错误，对于4XX状态码的结果，数据中会具体解释错误的原因。

对于GET请求查询的数据，格式如下：

* 列表查询的结果数据格式：
    ```
    {
        "count": 查询到的结果总数量（不分页）,
        "next": 下一页数据的URL（没有则为null）,
        "previous": 上一页数据的URL（没有则为null）,
        "results": [结果1（格式同详情查询）, 结果2, ...]
    }
        ```
* 详情查询的结果数据格式：
    ```
    {
        属性1: 属性1的值,
        属性2: 属性2的值,
        ...
    }
    ```

<br />

## 浏览API

本API如通过浏览器访问，则会显示一套前端页面以供操作；通过AJAX请求则直接放回JSON数据。

<br />

## API介绍说明

在其他部分的具体API介绍中对于某一资源将给出列表和详情的URL，支持的请求类型，以及列表和详情中分别涉及的资源属性。
    
属性前加*表示此属性只读，仅查询时显示，创建、更新时不提供此属性，其值由系统自动决定。
    
属性前加#表示此属性只写，查询时不显示此属性，创建或更新时提供此属性。

例如：

>题目API
>
>   列表：```GET|POST /api-server/problems/```
>
>   属性：
>   ```
>   {
>        *id: 题目ID,
>        *creator: 创建者,
>        *updater: 最后更新者,
>        *create_time: 创建时间,
>        *update_time: 更新时间,
>        title: 题目,
>        introduction: 简介,
>        source: 来源,
>        author: 作者,
>        status: 状态,
>        test_type: 测试类型,
>        *meta_problem: 所属题元id,
>        description: 题意id,
>        sample: 样例id,
>   }
>   ```
>   详情：```GET|PUT|PATCH|DELETE /api-server/problems/{ problem id }/```、
>
>   属性：
>   ```
>   {
>        *id: 题目ID,
>        *creator: 创建者,
>        *updater: 最后更新者,
>        *create_time: 创建时间,
>        *update_time: 更新时间,
>        title: 题目,
>        introduction: 简介,
>        source: 来源,
>        author: 作者,
>        status: 状态,
>        test_type: 测试类型,
>        *meta_problem: 所属题元id,
>        description: 题意id,
>        sample: 样例id,
>   }
>   ```

则其对应的API为：
```
GET    /api-server/problems/                 # 查询所有题目，查询到的题目属性见上方，包含星号内容
GET    /api-server/problems/{ problem id }/  # 查询某道题目的详情，查询到的题目属性见上方，包含星号内容
POST   /api-server/problems/                 # 创建一道题目，需提供属性见上方，不包含星号内容
PUT    /api-server/problems/{ problem id }/  # 更新一道题目（提供全部属性），需提供属性见上方，不包含星号内容
PATCH  /api-server/problems/{ problem id }/  # 更新一道题目（只提供需修改属性），可提供属性见上方，不包含星号内容
DELETE /api-server/problems/{ problem id }/  # 删除一道题目
```
